<form id="formSubscribe" action="/" method="POST">
  <input
    type="hidden"
    id="token"
    name="token"
    value="8A9B781A9C8BB357239D9FFE6CE8F32EA8A9852U"
  />
  <div id="subscribe-container" style="height: 250px"></div>
</form>

<script src="https://sandbox.flow.cl/app/elements/flow-1.1.0.min.js?20241202"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var flow = Flow();
    var elements = flow.elements();
    var token = document.getElementById("token").value;
    console.log("Token obtenido:", token);
    var subscribe = elements.create("subscribe", {
      style: {
        backgroundColor: "#f8f9fa",
      },
    });

    console.log("Objeto subscribe:", subscribe);
    subscribe.mount("#subscribe-container", token);
    var form = document.getElementById("formSubscribe");

    flow
      .handleCardSubscribed(subscribe)
      .then(function (data) {
        console.log("Pago procesado correctamente:", data);

        setTimeout(function () {
          console.log("Enviando formulario...");
          form.submit();
        }, 3000);
      })
      .catch(function (error) {
        console.error("Error en el pago:", error);
      });
  });
</script>
